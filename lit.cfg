# Lit local configuration for Cheerp tests

import lit.formats
import os

# Test name and source root
config.name = 'Cheerp'
config.test_source_root = os.path.dirname(__file__)

# Use Shell test format 
config.test_format = lit.formats.ShTest(execute_external=True)

# File suffixes to consider as tests
config.suffixes = ['.cpp', '.c']

# Exclude certain patterns
config.excludes = ['unit/tests.h', 'Inputs']

# Read compilation flags from environment variables
cheerp_base = '/opt/cheerp/bin/clang++'
cheerp_flags = os.environ.get('CHEERP_FLAGS', '')
extra_flags = os.environ.get('EXTRA_FLAGS', '')

# Combine flags
all_flags = ' '.join(filter(None, [cheerp_flags, extra_flags]))
if all_flags:
    cheerp_cmd = cheerp_base + ' ' + all_flags
else:
    cheerp_cmd = cheerp_base

# Substitutions for common patterns
config.substitutions.append(('%cheerp_clang', cheerp_cmd))
config.substitutions.append(('%FileCheck', '/home/alex/llvm-lit-exploration/llvm_venv/bin/FileCheck'))
config.substitutions.append(('%node', 'node'))

# %S = directory of the test
# %s = path to the test file  
# %t = temporary file path unique to this test

# Enable execution of tests from within the test directory
config.test_exec_root = os.path.dirname(__file__)

# Set environment variables if needed
if 'PATH' in os.environ:
    config.environment['PATH'] = os.environ['PATH']
